<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Paginatto ‚Äî √Årea de Membros</title>

  <style>
    :root{
      --bg: #0d5f70;
      --bg-soft: #0e6f83;
      --page: #f6fbfc;
      --card: #ffffff;
      --ink: #0f2024;
      --muted:#6a7a80;
      --brand:#12a4bd;
      --brand-2:#0db2c9;
      --gold:#c8a96a;
      --shadow: 0 8px 24px rgba(3,41,48,.10);
      --radius: 16px;
    }
    *{ box-sizing:border-box; margin:0; padding:0; }
    body{
      background: var(--page);
      color: var(--ink);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif;
      line-height: 1.55;
    }

    /* ====== TELA 1 (LANDING) ====== */
    #landing{
      min-height: 100vh;
      position: relative;
      color:#ffffff;
      background-image: url('logo azul sem sombra.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
    #landing::before{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(
        180deg,
        rgba(0,0,0,0.55) 0%,
        rgba(0,0,0,0.65) 40%,
        rgba(0,0,0,0.75) 100%
      );
      z-index:0;
    }
    .landing-inner{
      position:relative;
      z-index:1;
      min-height:100vh;
      max-width:1100px;
      margin:0 auto;
      padding:20px 18px 40px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:space-between;
    }
    .landing-header{
      width:100%;
      display:flex;
      justify-content:center;
      margin-top:6px;
    }
    .landing-brand-name{
      font-weight:700;
      letter-spacing:.22em;
      font-size:15px;
      text-transform:uppercase;
      opacity:.9;
    }
    .hero{
      width:100%;
      max-width:540px;
      text-align:center;
      display:grid;
      gap:18px;
      padding-bottom:60px;
    }
    .hero h1{
      font-size: clamp(28px, 5vw, 40px);
      line-height:1.15;
      font-weight:800;
      text-shadow:0 10px 30px rgba(0,0,0,.7);
    }
    .hero p{
      opacity:.95;
      max-width:420px;
      margin:0 auto;
      font-size:14px;
    }
    .btn-primary{
      appearance:none;
      border:0;
      border-radius: 999px;
      padding: 14px 22px;
      background: linear-gradient(90deg, #18b0c8 0%, #22d1e2 100%);
      color:#00333d;
      font-weight: 800;
      text-transform:uppercase;
      cursor:pointer;
      transition: .18s;
      box-shadow: 0 14px 34px rgba(0,0,0,.55);
    }
    .btn-primary:hover{
      transform:translateY(-1px);
      filter:brightness(1.05);
    }

    /* HEADER */
    #appHeader{
      position:sticky;
      top:0;
      background: linear-gradient(180deg, rgb(215,217,218) 0%, rgba(13,95,112,.92) 50%);
      display:none;
      z-index:50;
    }
    .nav-wrap{
      max-width:980px;
      margin:auto;
      padding:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .menu{
      display:flex;
      gap:12px;
    }
    .menu a{
      color:white;
      text-decoration:none;
      font-weight:700;
    }

    .search-bar{
      display:none;
      max-width:980px;
      margin:0 auto;
      padding:15px;
    }
    .search{
      background:white;
      border-radius:99px;
      padding:8px 15px;
      display:flex;
      gap:10px;
      box-shadow:var(--shadow);
    }
    .search input{
      border:0;
      outline:none;
      flex:1;
    }

    /* APP MAIN */
    #appMain{ display:none; }

    .section{
      max-width:980px;
      margin:30px auto;
      padding:0 15px;
    }
    .grid{
      display:grid;
      gap:15px;
    }
    @media(min-width:650px){
      .grid{ grid-template-columns: repeat(2,1fr); }
    }
    @media(min-width:960px){
      .grid{ grid-template-columns: repeat(3,1fr); }
    }

    .card{
      background:white;
      border-radius:16px;
      overflow:hidden;
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
    }
    .thumb{
      width:100%;
      aspect-ratio:16/9;
      object-fit:cover;
    }
    .card-body{ padding:14px; }
    .card h3{ font-size:16px; font-weight:800; margin-bottom:6px; }
    .card p{ font-size:13px; color:#6a7a80; margin-bottom:12px; }

    .btn{
      background: linear-gradient(90deg, var(--brand), var(--brand-2));
      border:0;
      padding:10px 14px;
      border-radius:12px;
      color:white;
      cursor:pointer;
      font-weight:700;
    }

    .msg{
      color:#c92e2e;
      font-size:14px;
      margin-top:10px;
    }

    .overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.85);
      display:flex;
      justify-content:center;
      align-items:center;
      padding:20px;
      z-index:9999;
    }
    iframe{ width:100%; height:70vh; }
    .close{
      position:absolute; top:20px; left:20px;
      background:black; color:white;
      border:0; padding:10px 14px;
      border-radius:10px; cursor:pointer;
    }
  </style>
</head>
<body>

<!-- LANDING -->
<section id="landing">
  <div class="landing-inner">
    <div class="landing-header">
      <div class="landing-brand-name">PAGINATTO</div>
    </div>
    <div class="hero">
      <h1>As melhores receitas e e-books num s√≥ lugar</h1>
      <p>Acesse agora todos os produtos liberados para o seu e-mail.</p>
      <button id="enterBtn" class="btn-primary">Acessar</button>
    </div>
  </div>
</section>

<!-- HEADER -->
<header id="appHeader">
  <div class="nav-wrap">
    <div class="brand-mini" id="goHome">
      <span>Paginatto</span>
    </div>

    <nav class="menu">
      <a href="#" id="menuInicio">In√≠cio</a>
      <a href="#" id="menuVideos">Meus V√≠deos</a>
      <a href="#" id="menuEbooks">Meus E-books</a>
      <a href="#" id="menuRecs">Recomenda√ß√µes</a>
      <a href="#" id="logoutBtn">Sair</a>
    </nav>
  </div>

  <div class="search-bar" id="searchBar">
    <div class="search">
      <input id="q" placeholder="Buscar‚Ä¶">
      <button id="btnSearch" class="btn">üîé</button>
    </div>
  </div>
</header>

<!-- MAIN -->
<main id="appMain">

  <section class="section" id="videos">
    <h2>Suas V√≠deo Aulas</h2>
    <p class="sub">Cursos de v√≠deo liberados para o seu e-mail.</p>
    <div id="gridVideos" class="grid"></div>
    <p id="msgVideos" class="msg" style="display:none">Nenhum v√≠deo liberado.</p>
  </section>

  <section class="section" id="ebooks">
    <h2>Seus E-books</h2>
    <p class="sub">E-books liberados para o seu e-mail.</p>
    <div id="gridEbooks" class="grid"></div>
    <p id="msgEbooks" class="msg" style="display:none">Nenhum e-book liberado.</p>
  </section>

  <section class="section" id="recs">
    <h2>Outros produtos pra voc√™</h2>
    <p class="sub">Sugest√µes do cat√°logo.</p>
    <div id="gridRecs" class="grid"></div>
    <p id="msgRecs" class="msg" style="display:none">Nenhuma recomenda√ß√£o.</p>
  </section>

</main>

<!-- FOOTER -->
<footer style="background:#0d5f70; color:white; text-align:center; padding:30px;">
  ¬© 2025 PAGINATTO ‚Äî TODOS OS DIREITOS RESERVADOS.
</footer>


<script>
/*======================================================
    HELPERS
======================================================*/
const el = (s)=>document.querySelector(s);
const create = (t)=>document.createElement(t);

function toDrive(url){
  if(!url) return "";
  if(url.includes("/preview")) return url;
  if(url.includes("/view")) return url.replace("/view","/preview");
  return url;
}

function openModal(url){
  const old = el("#overlay");
  if(old) old.remove();

  const o = create("div");
  o.id = "overlay";
  o.className = "overlay";

  const close = create("button");
  close.className = "close";
  close.textContent = "Fechar";
  close.onclick = ()=>o.remove();

  const iframe = create("iframe");
  iframe.src = toDrive(url);
  iframe.allowFullscreen = true;

  o.appendChild(close);
  o.appendChild(iframe);
  document.body.appendChild(o);
}

/*======================================================
    CLASSIFICA√á√ÉO ‚Äî v√≠deo sempre ganha
======================================================*/
function classify(item){
  if(item.video) return "video";
  if(item.ebook || item.link || item.drive_link) return "ebook";

  const t = (item.type || item.tipo || "").toLowerCase();
  if(t.includes("video")) return "video";
  return "ebook";
}

/*======================================================
    LOAD MODULE ITEMS
======================================================*/
async function loadModuleItems(key){
  try{
    const mod = await import(`/${key}/module.js`);

    let arr = [];

    const sets = [
      mod.itens,
      mod.videos,
      mod.videoAulas,
      mod.receitas,
      mod.aulas,
      mod.ebooks,
      mod.ebooksDestacados,
      mod.bonus
    ];

    sets.forEach(s=>{
      if(Array.isArray(s)) arr.push(...s);
    });

    return arr.map((x,i)=>({
      ...x,
      __order: i,
      __from: key
    }));
  }catch(e){
    console.error("Falha m√≥dulo",key,e);
    return [];
  }
}

/*======================================================
    RENDER CARD
======================================================*/
function renderCard(item, label, action){
  const c = create("div");
  c.className = "card";

  const img = create("img");
  img.className = "thumb";
  img.src = item.thumbnail || item.imagem || item.capa || item.cover_image_url || "";

  const b = create("div");
  b.className = "card-body";

  const h = create("h3");
  h.textContent = item.nome || item.name;

  const p = create("p");
  p.textContent = item.descricao || item.description || "";

  const btn = create("button");
  btn.className = "btn";
  btn.textContent = label;
  btn.onclick = action;

  b.appendChild(h);
  b.appendChild(p);
  b.appendChild(btn);

  c.appendChild(img);
  c.appendChild(b);
  return c;
}

/*======================================================
    LOAD USER PRODUCTS
======================================================*/
async function loadProducts(){
  try{
    const email = localStorage.getItem("chef_user_email");
    if(!email) return;

    const r = await fetch("/api/my-products",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ email })
    });

    const data = await r.json();
    if(!data.success) return alert("Erro ao carregar produtos.");

    const dbProducts = data.products || [];

    const combos = dbProducts.filter(p=>p.type==="combo");
    const normal = dbProducts.filter(p=>p.type!=="combo");

    let moduleItems = [];
    for(const c of combos){
      const items = await loadModuleItems(c.deliverable_key);
      moduleItems.push(...items);
    }

    const normalizedDB = normal.map(p=>({
      ...p,
      nome: p.name,
      descricao: p.description,
      ebook: p.drive_link || null,
      video: null,
      imagem: p.cover_image_url
    }));

    let all = [...moduleItems, ...normalizedDB];

    const videos = [];
    const ebooks = [];

    all.forEach(item=>{
      const tipo = classify(item);
      if(tipo==="video") videos.push(item);
      else ebooks.push(item);
    });

    /* RENDER VIDEOS */
    const V = el("#gridVideos");
    V.innerHTML = "";
    videos.forEach(v=>{
      const url = v.video || v.drive_link || v.ebook || v.link;
      V.appendChild(renderCard(v,"Assistir",()=>openModal(url)));
    });
    el("#msgVideos").style.display = videos.length ? "none" : "block";

    /* RENDER EBOOKS */
    const E = el("#gridEbooks");
    E.innerHTML = "";
    ebooks.forEach(e=>{
      const url = e.ebook || e.link || e.drive_link;
      E.appendChild(renderCard(e,"Abrir E-book",()=>openModal(url)));
    });
    el("#msgEbooks").style.display = ebooks.length ? "none" : "block";

  }catch(e){
    console.error("Erro loadProducts",e);
  }
}

/*======================================================
    RECS
======================================================*/
async function loadRecs(){
  try{
    const email = localStorage.getItem("chef_user_email");
    if(!email) return;
    const r = await fetch("/api/recommendations?email="+email);
    const data = await r.json();

    const list = (data.items || data.products || []).filter(p=>p.type!=="combo");
    const R = el("#gridRecs");
    R.innerHTML = "";

    list.forEach(p=>{
      R.appendChild(renderCard(p,"Comprar",()=>window.open(p.checkout_link,"_blank")));
    });

    el("#msgRecs").style.display = R.children.length ? "none" : "block";
  }catch(e){
    console.error("Erro loadRecs",e);
  }
}

/*======================================================
    SEARCH
======================================================*/
function searchLocal(q){
  const term = q.toLowerCase();
  document.querySelectorAll(".card").forEach(card=>{
    const t = card.querySelector("h3")?.textContent.toLowerCase() || "";
    const d = card.querySelector("p")?.textContent.toLowerCase() || "";
    card.style.display = (t.includes(term) || d.includes(term)) ? "block" : "none";
  });
}
el("#btnSearch").onclick = ()=>searchLocal(el("#q").value);

/*======================================================
    NAV
======================================================*/
function show(id){
  ["videos","ebooks","recs"].forEach(sec=>{
    el("#"+sec).style.display = (id==="all" || sec===id) ? "block" : "none";
  });
}
el("#menuInicio").onclick = (e)=>{ e.preventDefault(); show("all"); };
el("#menuVideos").onclick = (e)=>{ e.preventDefault(); show("videos"); };
el("#menuEbooks").onclick = (e)=>{ e.preventDefault(); show("ebooks"); };
el("#menuRecs").onclick   = (e)=>{ e.preventDefault(); show("recs"); };

el("#goHome").onclick = ()=>show("all");

/*======================================================
    ENTRAR
======================================================*/
async function openApp(){
  el("#landing").style.display = "none";
  el("#appHeader").style.display = "block";
  el("#searchBar").style.display = "block";
  el("#appMain").style.display = "block";

  show("videos");
  await loadProducts();
  await loadRecs();
}

el("#enterBtn").onclick = ()=>{
  const email = localStorage.getItem("chef_user_email");
  if(!email) location.href = "login.html";
  else openApp();
};

/*======================================================
    LOGOUT
======================================================*/
el("#logoutBtn").onclick = ()=>{
  localStorage.removeItem("chef_user_email");
  location.href = "login.html";
};
</script>

</body>
</html>





