<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Paginatto ‚Äî √Årea de Membros</title>

<style>
  :root{
    /* paleta Paginatto (teal/azul) */
    --bg: #0d5f70;            /* fundo hero/nav */
    --bg-soft: #0e6f83;       /* varia√ß√£o */
    --page: #f6fbfc;          /* fundo da p√°gina/claro */
    --card: #ffffff;
    --ink: #0f2024;
    --muted:#6a7a80;
    --brand:#12a4bd;          /* acentos */
    --brand-2:#0db2c9;
    --gold:#c8a96a;           /* CTAs secund√°rios se quiser */
    --shadow: 0 8px 24px rgba(3,41,48,.10);
    --radius: 16px;
  }

  *{ box-sizing:border-box; margin:0; padding:0; }

  body{
    background: var(--page);
    color: var(--ink);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif;
    line-height: 1.55;
  }

  /* ====== TELA 1 (LANDING) ====== */
  #landing{
    min-height: 100dvh;
    display: grid;
    place-items: center;
    text-align: center;
    padding: 32px 18px 46px;
    background:
      radial-gradient(1200px 900px at 80% -20%, #138aa1 0%, transparent 60%),
      linear-gradient(160deg, var(--bg) 0%, var(--bg-soft) 100%);
    color: #fff;
  }
  .hero{
    max-width: 520px;
    display: grid;
    gap: 18px;
    animation: fadeUp .5s ease both;
  }
  .brand-hero{
    display:flex; align-items:center; gap:12px; justify-content:center;
  }
  .brand-hero img{ width:44px; height:44px; object-fit:contain }
  .brand-hero strong{ font-size:20px; letter-spacing:.4px }

  .hero h1{
    font-size: clamp(28px, 6vw, 36px);
    line-height: 1.15;
    font-weight: 800;
  }
  .hero p{ opacity:.95 }

  .btn-primary{
    appearance:none;
    border:0;
    border-radius: 999px;
    padding: 14px 22px;
    background: linear-gradient(90deg, var(--brand) 0%, var(--brand-2) 100%);
    color:#00262d;
    font-weight: 800;
    letter-spacing:.3px;
    box-shadow: 0 10px 28px rgba(13,178,201,.35);
    cursor:pointer;
    transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
  }
  .btn-primary:active{ transform: translateY(1px); filter:brightness(.98) }

  /* ====== HEADER / NAV ====== */
  header{
    position: sticky; top:0; z-index: 50;
    background: linear-gradient(180deg, rgba(13,95,112,1) 0%, rgba(13,95,112,.92) 100%);
    color:#fff;
    box-shadow: var(--shadow);
  }
  .nav-wrap{
    max-width: 980px; margin: 0 auto;
    padding: 10px 14px;
    display:flex; align-items:center; justify-content:space-between; gap:12px;
  }
  .brand-mini{ display:flex; align-items:center; gap:10px; cursor:pointer }
  .brand-mini img{ width:30px; height:30px; object-fit:contain }
  .brand-mini span{ font-weight:800; letter-spacing:.4px }

  .menu{
    display:flex; align-items:center; gap:14px;
    overflow-x:auto; scrollbar-width:none;
  }
  .menu a, .menu button{
    color:#e8fdff; text-decoration:none; white-space:nowrap;
    font-size:14px; font-weight:700; letter-spacing:.2px;
    background:transparent; border:0; cursor:pointer; padding:8px 10px;
    border-radius: 10px;
  }
  .menu a:hover, .menu button:hover{ background: rgba(255,255,255,.08) }

  /* ====== BUSCA ====== */
  .search-bar{
    max-width:980px; margin: 14px auto 0; padding: 0 14px 12px;
  }
  .search{
    display:flex; gap:8px; background:var(--card); border-radius:999px; padding:8px 8px 8px 14px;
    box-shadow: var(--shadow);
  }
  .search input{
    border:0; outline:0; flex:1; font-size:14px; background:transparent; color:var(--ink);
  }
  .icon-btn{
    width:38px; height:38px; border-radius:50%; border:0; cursor:pointer;
    background:linear-gradient(120deg, var(--brand) 0%, var(--brand-2) 100%);
    color:#00313a; font-weight:800;
  }

  /* ====== CONTE√öDO ====== */
  .section{
    max-width: 980px; margin: 12px auto 24px; padding: 0 14px;
  }
  .h2{
    font-size: clamp(22px, 3.8vw, 28px);
    font-weight: 900; letter-spacing:.2px;
    margin: 24px 0 8px;
  }
  .sub{ color: var(--muted); margin-bottom: 14px }

  .grid{
    display:grid; grid-template-columns: 1fr; gap:14px;
  }
  @media (min-width:540px){ .grid{ grid-template-columns: repeat(2,1fr) } }
  @media (min-width:920px){ .grid{ grid-template-columns: repeat(3,1fr) } }

  .card{
    background: var(--card);
    border-radius: var(--radius);
    overflow:hidden;
    box-shadow: var(--shadow);
    display:flex; flex-direction:column;
  }
  .thumb{ aspect-ratio: 16/9; width:100%; object-fit:cover; background:#eaf1f3 }
  .card-body{ padding:12px }
  .card h3{ font-size:16px; font-weight:800; margin: 0 0 6px }
  .card p{ color:var(--muted); font-size:13px; margin-bottom:10px }
  .row-btns{ display:flex; gap:8px; }
  .btn{
    flex:1; padding:10px 12px; border-radius:10px; border:0; cursor:pointer; font-weight:800; letter-spacing:.2px;
    background: #e9f6f8; color:#054957;
  }
  .btn:hover{ filter:brightness(.98) }
  .btn.buy{ background: linear-gradient(90deg, var(--brand) 0%, var(--brand-2) 100%); color:#002e36 }

  .msg{ color:#d12f2f; font-size:14px; }

  /* ====== MODAIS (video / ebook) ====== */
  .overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.85);
    display:flex; align-items:center; justify-content:center;
    z-index:1000; padding:18px;
    animation: fade .15s ease;
  }
  .player{
    width:min(960px, 100%); background:#000; border-radius:16px; overflow:hidden; position:relative;
  }
  .player iframe{ width:100%; height:min(70dvh, 520px); border:0; display:block }
  .close{
    position:absolute; top:10px; left:10px;
    background:rgba(0,0,0,.6); border:0; color:#fff; padding:8px 12px; border-radius:999px; cursor:pointer;
  }

  /* ====== FOOTER ====== */
  footer{
    text-align:center; padding:28px 12px; color:#d6f7fc; background: var(--bg);
    font-size:12px; letter-spacing:.2px;
  }

  /* animations */
  @keyframes fadeUp{
    from{ opacity:0; transform: translateY(8px) }
    to{ opacity:1; transform:none }
  }
  @keyframes fade{ from{ opacity:.6 } to{ opacity:1 } }
</style>
</head>
<body>

<!-- ========= TELA 1 (LANDING) ========= -->
<section id="landing">
  <div class="hero">
    <div class="brand-hero">
      <img src="logo-branca.png" alt="Paginatto">
      <strong>Paginatto</strong>
    </div>
    <h1>As melhores receitas e e-books num s√≥ lugar</h1>
    <p>Entre agora na sua √°rea de membros e acesse tudo que j√° est√° liberado para o seu e-mail.</p>
    <button class="btn-primary" id="enterBtn">Acessar</button>
  </div>
</section>

<!-- ========= TELA 2 (APP) ========= -->
<header id="appHeader" style="display:none">
  <div class="nav-wrap">
    <div class="brand-mini" id="goHome">
      <img src="logo-branca.png" alt="Paginatto">
      <span>Paginatto</span>
    </div>
    <nav class="menu">
      <a href="#" id="menuInicio">In√≠cio</a>
      <a href="#videos">Meus V√≠deos</a>
      <a href="#ebooks">Meus E-books</a>
      <a href="#recs">Recomenda√ß√µes</a>
      <button id="logoutBtn">Sair</button>
    </nav>
  </div>
  <div class="search-bar">
    <div class="search">
      <input id="q" placeholder="Buscar receitas, e-books, v√≠deos‚Ä¶ (ex.: dor, bolo, airfryer)">
      <button class="icon-btn" id="btnSearch">üîé</button>
    </div>
  </div>
</header>

<main id="appMain" style="display:none">
  <!-- v√≠deos -->
  <section class="section" id="videos">
    <h2 class="h2">Suas V√≠deo Aulas</h2>
    <p class="sub">Cursos em v√≠deo liberados para o seu e-mail.</p>
    <div id="gridVideos" class="grid"></div>
    <p id="msgVideos" class="msg" style="display:none"></p>
  </section>

  <!-- e-books -->
  <section class="section" id="ebooks">
    <h2 class="h2">Seus E-books</h2>
    <p class="sub">E-books liberados para o seu e-mail.</p>
    <div id="gridEbooks" class="grid"></div>
    <p id="msgEbooks" class="msg" style="display:none"></p>
  </section>

  <!-- recomenda√ß√µes -->
  <section class="section" id="recs">
    <h2 class="h2">Outros produtos pra voc√™</h2>
    <p class="sub">Sugest√µes do nosso cat√°logo que ainda n√£o est√£o liberadas pra voc√™.</p>
    <div id="gridRecs" class="grid"></div>
    <p id="msgRecs" class="msg" style="display:none"></p>
  </section>
</main>

<footer>¬© 2025 PAGINATTO ‚Äî TODOS OS DIREITOS RESERVADOS.</footer>

<script>
  // ===== helpers
  const $ = (sel) => document.querySelector(sel);
  const el = (id) => document.getElementById(id);

  function toDrivePreview(url){
    const m = String(url||'').match(/drive\.google\.com\/file\/d\/([^/]+)/);
    if(!m) return null;
    return `https://drive.google.com/file/d/${m[1]}/preview`;
  }

  function openPlayer(url, title){
    const embed = toDrivePreview(url) || url;
    const wrap = document.createElement('div');
    wrap.className = 'overlay';
    wrap.innerHTML = `
      <div class="player">
        <button class="close" onclick="this.closest('.overlay').remove()">‚Üê Voltar</button>
        <iframe src="${embed}" allow="autoplay; encrypted-media" allowfullscreen title="${title||''}"></iframe>
      </div>`;
    document.body.appendChild(wrap);
  }

  // ===== navega√ß√£o landing -> app
  function showApp(){
    $('#landing').style.display = 'none';
    $('#appHeader').style.display = '';
    $('#appMain').style.display = '';
    window.scrollTo({top:0, behavior:'instant'});
  }

  // ===== sess√£o / login
  function requireLogin(){
    const email = localStorage.getItem('chef_user_email');
    if(!email){
      // volta pra tela de login se n√£o estiver logado
      window.location.href = '/login.html';
      return null;
    }
    return email.toLowerCase().trim();
  }

  async function loadMyProducts(){
  const email = requireLogin(); 
  if (!email) return;

  try{
    const resp = await fetch('/api/my-products', {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify({ email })
    });

    const data = await resp.json();

    if (!resp.ok || !data.success) {
      throw new Error(data.error || data.message || 'Erro ao carregar.');
    }

    const items = Array.isArray(data.items) ? data.items : [];

    const vids = items.filter(p => (p.type || '').toLowerCase().includes('video'));
    const ebooks = items.filter(p => (p.type || '').toLowerCase().includes('ebook'));

    renderCards(
      vids,
      el('gridVideos'),
      'Assistir',
      (p) => openPlayer(p.drive_link || p.checkout_link, p.name)
    );

    renderCards(
      ebooks,
      el('gridEbooks'),
      'Abrir',
      (p) => openPlayer(p.drive_link || p.checkout_link, p.name)
    );

    if (vids.length === 0) {
      el('msgVideos').style.display = '';
      el('msgVideos').textContent = 'Voc√™ ainda n√£o tem v√≠deo aulas liberadas.';
    } else {
      el('msgVideos').style.display = 'none';
    }

    if (ebooks.length === 0) {
      el('msgEbooks').style.display = '';
      el('msgEbooks').textContent = 'Voc√™ ainda n√£o tem e-books liberados.';
    } else {
      el('msgEbooks').style.display = 'none';
    }
  } catch (e){
    console.error(e);
    el('msgVideos').style.display = '';
    el('msgVideos').textContent = 'Erro ao carregar seus v√≠deos.';
    el('msgEbooks').style.display = '';
    el('msgEbooks').textContent = 'Erro ao carregar seus e-books.';
  }
}
  
  function renderCards(list, container, cta, onOpen){
  container.innerHTML = '';
  list.forEach((p) => {
    const div = document.createElement('div');
    div.className = 'card';

    const cover = p.cover_image_url || '';
    const desc  = p.description || '';

    div.innerHTML = `
      <img class="thumb" src="${cover}" alt="${p.name || ''}">
      <div class="card-body">
        <h3>${p.name || ''}</h3>
        <p>${desc}</p>
        <div class="row-btns">
          <button class="btn">${cta}</button>
        </div>
      </div>
    `;

    const btn = div.querySelector('button.btn');
    btn.addEventListener('click', () => onOpen(p));

    container.appendChild(div);
  });
}

  async function loadRecs(){
    const email = requireLogin(); if(!email) return;
    try{
      const r = await fetch('/api/recommendations?email='+encodeURIComponent(email));
      const data = await r.json();
      if(!r.ok) throw new Error(data?.error || 'Erro');
      const list = Array.isArray(data?.items) ? data.items : data;

      const cont = el('gridRecs');
      cont.innerHTML='';
      list.forEach(p=>{
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML = `
          <img class="thumb" src="${p.cover_image_url||''}" alt="${p.name||''}">
          <div class="card-body">
            <h3>${p.name||''}</h3>
            <p>${p.description||''}</p>
            <div class="row-btns">
              <a class="btn buy" href="${p.checkout_link||'#'}" target="_blank" rel="noopener">Comprar</a>
            </div>
          </div>`;
        cont.appendChild(div);
      });
      if(list.length===0){ el('msgRecs').style.display=''; el('msgRecs').textContent='Nada sugerido no momento.'; }
    }catch(e){
      el('msgRecs').style.display=''; el('msgRecs').textContent='Falha ao carregar recomenda√ß√µes.';
      console.error(e);
    }
  }

  async function doSearch(){
    const q = el('q').value.trim();
    if(!q) return;
    const email = requireLogin(); if(!email) return;

    try{
      const res = await fetch('/api/search?q='+encodeURIComponent(q)+'&email='+encodeURIComponent(email));
      const data = await res.json();
      if(!res.ok) throw new Error(data?.error||'Erro');

      const items = Array.isArray(data?.items) ? data.items : data;
      const owned = items.filter(x=>x.owned);
      const notOwned = items.filter(x=>!x.owned);

      // mostra resultados sobrescrevendo grids
      renderCards(
        owned, el('gridVideos'), 'Abrir',
        (p)=>openPlayer(p.drive_link||p.deliverable_url||p.checkout_link, p.name)
      );
      // usa grid de e-books para ‚Äún√£o possui‚Äù com bot√£o comprar
      const cont = el('gridEbooks'); cont.innerHTML='';
      notOwned.forEach(p=>{
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML = `
          <img class="thumb" src="${p.cover_image_url||''}" alt="${p.name||''}">
          <div class="card-body">
            <h3>${p.name||''}</h3>
            <p>${p.description||''}</p>
            <div class="row-btns">
              ${p.checkout_link ? `<a class="btn buy" href="${p.checkout_link}" target="_blank" rel="noopener">Comprar</a>` : `<button class="btn" disabled>Indispon√≠vel</button>`}
            </div>
          </div>`;
        cont.appendChild(div);
      });

      // sobe at√© os grids
      document.location.hash = '#videos';
    }catch(e){
      alert('Erro na busca.');
      console.error(e);
    }
  }

  // ===== eventos UI
  el('enterBtn').addEventListener('click', ()=>{
    // exige sess√£o antes de exibir o app
    if(!requireLogin()) return;
    showApp();
    loadMyProducts();
    loadRecs();
  });

  el('menuInicio').addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top:0, behavior:'smooth'}); });
  el('goHome').addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));
  el('btnSearch').addEventListener('click', doSearch);
  el('q').addEventListener('keydown', (e)=> (e.key==='Enter') && doSearch());

  el('logoutBtn').addEventListener('click', ()=>{
    localStorage.removeItem('chef_user_email');
    location.href = '/login.html';
  });

  // Se j√° est√° logado e veio direto, mostre o app
  (function boot(){
    if(requireLogin()){
      // mant√©m a landing (voc√™ pediu 2 etapas).  
      // Se quiser abrir direto a √°rea para logados, troque para:
      // showApp(); loadMyProducts(); loadRecs();
    }
  })();
</script>
</body>
</html>


