<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Paginatto ‚Äî √Årea de Membros</title>

  <style>
    :root{
      --bg: #0d5f70;
      --bg-soft: #0e6f83;
      --page: #f6fbfc;
      --card: #ffffff;
      --ink: #0f2024;
      --muted:#6a7a80;
      --brand:#12a4bd;
      --brand-2:#0db2c9;
      --gold:#c8a96a;
      --shadow: 0 8px 24px rgba(3,41,48,.10);
      --radius: 16px;
    }
    *{ box-sizing:border-box; margin:0; padding:0; }
    body{
      background: var(--page);
      color: var(--ink);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif;
      line-height: 1.55;
    }

    /* ====== TELA 1 (LANDING) ====== */
    #landing{
      min-height: 100vh;
      position: relative;
      color:#ffffff;
      background-image: url('logo azul sem sombra.png');
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
    }
    #landing::before{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(
        180deg,
        rgba(0,0,0,0.55) 0%,
        rgba(0,0,0,0.65) 40%,
        rgba(0,0,0,0.75) 100%
      );
      z-index:0;
    }
    .landing-inner{
      position:relative;
      z-index:1;
      min-height:100vh;
      max-width:1100px;
      margin:0 auto;
      padding:20px 18px 40px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:space-between;
    }
    .landing-header{
      width:100%;
      display:flex;
      justify-content:center;
      margin-top:6px;
    }
    .landing-brand{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
    }
    .landing-brand-name{
      font-weight:700;
      letter-spacing:.22em;
      font-size:15px;
      text-transform:uppercase;
      opacity:.9;
    }
    .hero{
      width:100%;
      max-width:540px;
      margin:0 auto;
      text-align:center;
      display:grid;
      gap:18px;
      padding-bottom:60px;
    }
    .hero h1{
      font-size: clamp(28px, 5vw, 40px);
      line-height:1.15;
      font-weight:800;
      text-shadow:0 10px 30px rgba(0,0,0,.7);
    }
    .hero p{
      opacity:.95;
      max-width:420px;
      margin:0 auto;
      font-size:14px;
    }
    .btn-primary{
      appearance:none;
      border:0;
      border-radius: 999px;
      padding: 14px 22px;
      background: linear-gradient(90deg, #18b0c8 0%, #22d1e2 100%);
      color:#00333d;
      font-weight: 800;
      letter-spacing:.12em;
      text-transform:uppercase;
      box-shadow: 0 14px 34px rgba(0,0,0,.55);
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .btn-primary:hover{
      transform:translateY(-1px);
      box-shadow:0 18px 40px rgba(0,0,0,.65);
      filter:brightness(1.02);
    }
    .btn-primary:active{
      transform:translateY(1px);
      box-shadow:0 10px 22px rgba(0,0,0,.55);
      filter:brightness(.98);
    }

    /* ====== HEADER / NAV APP ====== */
    #appHeader{
      position: sticky;
      top: 0;
      z-index: 50;
      background: linear-gradient(180deg, rgb(215, 217, 218) 0%, rgba(13,95,112,.92) 50%);
      color:#141313;
      box-shadow: var(--shadow);
      display:none;
    }
    .nav-wrap{
      max-width: 980px; margin: 0 auto;
      padding: 10px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      position: relative;
    }
    .brand-mini{ display:flex; align-items:center; gap:10px; cursor:pointer }
    .brand-mini img{ width:30px; height:30px; object-fit:contain }
    .brand-mini span{ font-weight:800; letter-spacing:.4px }

    .menu{
      display:flex; align-items:center; gap:14px;
      overflow-x:auto; scrollbar-width:none;
    }
    .menu a, .menu button{
      color:#e8fdff; text-decoration:none; white-space:nowrap;
      font-size:14px; font-weight:700; letter-spacing:.2px;
      background:transparent; border:0; cursor:pointer; padding:8px 10px;
      border-radius: 10px;
    }
    .menu a:hover, .menu button:hover{ background: rgba(255,255,255,.08) }

    .menu-toggle{
      display:none;
      align-items:center;
      justify-content:center;
      width:32px;
      height:32px;
      border-radius:999px;
      border:0;
      background:rgba(255,255,255,0.12);
      color:#e8fdff;
      cursor:pointer;
      font-size:18px;
    }

    /* ====== BUSCA ====== */
    .search-bar{
      max-width:980px; margin: 14px auto 0; padding: 0 14px 12px;
      display:none;
    }
    .search{
      display:flex; gap:8px; background:var(--card); border-radius:999px; padding:8px 8px 8px 14px;
      box-shadow: var(--shadow);
    }
    .search input{
      border:0; outline:0; flex:1; font-size:14px; background:transparent; color:var(--ink);
    }
    .icon-btn{
      width:38px; height:38px; border-radius:50%; border:0; cursor:pointer;
      background:linear-gradient(120deg, var(--brand) 0%, var(--brand-2) 100%);
      color:#00313a; font-weight:800;
    }

    /* ====== CONTE√öDO ====== */
    #appMain{
      display:none;
    }

    .section{
      max-width: 980px; margin: 12px auto 24px; padding: 0 14px;
    }
    .h2{
      font-size: clamp(22px, 3.8vw, 28px);
      font-weight: 900; letter-spacing:.2px;
      margin: 24px 0 8px;
    }
    .sub{ color: var(--muted); margin-bottom: 14px }

    .grid{
      display:grid; grid-template-columns: 1fr; gap:14px;
    }
    @media (min-width:540px){ .grid{ grid-template-columns: repeat(2,1fr) } }
    @media (min-width:920px){ .grid{ grid-template-columns: repeat(3,1fr) } }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex; flex-direction:column;
    }
    .thumb{ aspect-ratio: 16/9; width:100%; object-fit:cover; background:#eaf1f3 }
    .card-body{ padding:12px }
    .card h3{ font-size:16px; font-weight:800; margin: 0 0 6px }
    .card p{ color:var(--muted); font-size:13px; margin-bottom:10px }
    .row-btns{ display:flex; gap:8px; }
    .btn{
      flex:1; padding:10px 12px; border-radius:10px; border:0; cursor:pointer; font-weight:800; letter-spacing:.2px;
      background: #e9f6f8; color:#054957;
    }
    .btn:hover{ filter:brightness(.98) }
    .btn.buy{ background: linear-gradient(90deg, var(--brand) 0%, var(--brand-2) 100%); color:#002e36 }

    .msg{ color:#d12f2f; font-size:14px; }

    /* ====== MODAL VIDEO / EBOOK / M√ìDULO ====== */
    .overlay{
      position:fixed; inset:0; background:rgba(0,0,0,.85);
      display:flex; align-items:center; justify-content:center;
      z-index:1000; padding:18px;
      animation: fade .15s ease;
    }
    .player{
      width:min(960px, 100%);
      background:#000;
      border-radius:16px;
      overflow:hidden;
      position:relative;
    }
    .player iframe{
      width:100%;
      height:min(70dvh, 520px);
      border:0;
      display:block;
    }
    .player-inner{
      background:#f6fbfc;
      color:#0f2024;
      max-height:70dvh;
      overflow:auto;
      padding:16px;
    }
    .close{
      position:absolute; top:10px; left:10px;
      background:rgba(0,0,0,.6); border:0; color:#fff;
      padding:8px 12px; border-radius:999px; cursor:pointer;
    }

    footer{
      text-align:center; padding:28px 12px; color:#d6f7fc; background: var(--bg);
      font-size:12px; letter-spacing:.2px;
    }

    /* ====== MOBILE NAV ====== */
    @media (max-width: 720px){
      .nav-wrap{ justify-content:space-between; }
      .menu-toggle{ display:flex; }
      .menu{
        position:absolute;
        top:100%;
        right:14px;
        margin-top:8px;
        background:rgba(9, 113, 134, 0.98);
        border-radius:12px;
        padding:6px;
        box-shadow:var(--shadow);
        flex-direction:column;
        align-items:flex-start;
        display:none;
      }
      .menu.open{ display:flex; }
      .menu a, .menu button{
        width:100%;
        text-align:left;
        padding:8px 12px;
      }
    }

    @keyframes fadeUp{
      from{ opacity:0; transform: translateY(8px) }
      to{ opacity:1; transform:none }
    }
    @keyframes fade{ from{ opacity:.6 } to{ opacity:1 } }
  </style>
</head>
<body>

<!-- ========= TELA 1 (LANDING) ========= -->
<section id="landing">
  <div class="landing-inner">
    <header class="landing-header">
      <div class="landing-brand">
        <div class="landing-brand-name">PAGINATTO</div>
      </div>
    </header>
    <div class="hero">
      <h1>As melhores receitas e e-books num s√≥ lugar</h1>
      <p>Entre agora na sua √°rea de membros e acesse tudo que j√° est√° liberado para o seu e-mail.</p>
      <button class="btn-primary" id="enterBtn">
        Acessar
      </button>
    </div>
  </div>
</section>

<!-- ========= TELA 2 (APP) ========= -->
<header id="appHeader">
  <div class="nav-wrap">
    <div class="brand-mini" id="goHome">
      <img src="LOGO BRANCA COM SOMBRA.png" alt="Paginatto">
      <span>Paginatto</span>
    </div>
    <button class="menu-toggle" id="menuToggle">‚ãÆ</button>
    <nav class="menu" id="menuNav">
      <a href="#" id="menuInicio">In√≠cio</a>
      <a href="#" id="menuVideos">Meus V√≠deos</a>
      <a href="#" id="menuEbooks">Meus E-books</a>
      <a href="#" id="menuRecs">Recomenda√ß√µes</a>
      <button id="logoutBtn">Sair</button>
    </nav>
  </div>
  <div class="search-bar" id="searchBar">
    <div class="search">
      <input id="q" placeholder="Buscar receitas, e-books, v√≠deos‚Ä¶ (ex.: dor, bolo, airfryer)">
      <button class="icon-btn" id="btnSearch">üîé</button>
    </div>
  </div>
</header>

<main id="appMain">
  <section class="section" id="videos">
    <h2 class="h2">Suas V√≠deo Aulas</h2>
    <p class="sub">Cursos em v√≠deo liberados para o seu e-mail.</p>
    <div id="gridVideos" class="grid"></div>
    <p id="msgVideos" class="msg" style="display:none">Nenhum v√≠deo liberado para este e-mail.</p>
  </section>

  <section class="section" id="ebooks">
    <h2 class="h2">Seus E-books</h2>
    <p class="sub">E-books liberados para o seu e-mail.</p>
    <div id="gridEbooks" class="grid"></div>
    <p id="msgEbooks" class="msg" style="display:none">Nenhum e-book liberado para este e-mail.</p>
  </section>

  <section class="section" id="recs">
    <h2 class="h2">Outros produtos pra voc√™</h2>
    <p class="sub">Sugest√µes do nosso cat√°logo que ainda n√£o est√£o liberadas pra voc√™.</p>
    <div id="gridRecs" class="grid"></div>
    <p id="msgRecs" class="msg" style="display:none">Nenhuma recomenda√ß√£o neste momento.</p>
  </section>
</main>

<footer>¬© 2025 PAGINATTO ‚Äî TODOS OS DIREITOS RESERVADOS.</footer>

<script>
/* ===============================
   HELPERS
================================*/
const el = (s) => document.querySelector(s);
const create = (tag) => document.createElement(tag);

function toDrivePreview(url){
  if (!url) return "";
  if (url.includes("/preview")) return url;
  if (url.includes("/view")) return url.replace("/view", "/preview");
  return url;
}

/* ===============================
   MODAL / DRIVE
================================*/
function closeOverlay(){
  const o = el('#overlay');
  if (o) o.remove();
}

function openDriveModal(url, title){
  closeOverlay();

  const o = create('div');
  o.id = "overlay";
  o.className = "overlay";

  const p = create('div');
  p.className = "player";

  const c = create('button');
  c.className = "close";
  c.textContent = "Fechar";
  c.onclick = closeOverlay;

  const iframe = create('iframe');
  iframe.src = toDrivePreview(url);
  iframe.allowFullscreen = true;

  p.appendChild(c);
  p.appendChild(iframe);
  o.appendChild(p);
  document.body.appendChild(o);
}

/* ===============================
   M√ìDULO (COMBOS)
================================*/
async function openModule(key){
  closeOverlay();

  try{
    const modulePath = `/${key}/module.js`;
    const mod = await import(modulePath);

    const userProducts = Array.isArray(window.userProducts) ? window.userProducts : [];
    const email = window.userEmail || "";

    if (typeof mod.mount === "function"){
      const o = create('div');
      o.id = "overlay";
      o.className = "overlay";

      const p = create('div');
      p.className = "player";

      const c = create('button');
      c.className = "close";
      c.textContent = "Fechar";
      c.onclick = closeOverlay;

      const inner = create('div');
      inner.className = "player-inner";

      p.appendChild(c);
      p.appendChild(inner);
      o.appendChild(p);
      document.body.appendChild(o);

      mod.mount(inner, {
        email,
        deliverableKey: key,
        openDriveModal,
        toDrivePreview,
        products: userProducts
      });

      return;
    }

    // fallback: lista simples
    const itens = Array.isArray(mod.itens) ? mod.itens : [];

    const o = create('div');
    o.id = "overlay";
    o.className = "overlay";

    const p = create('div');
    p.className = "player";

    const c = create('button');
    c.className = "close";
    c.textContent = "Fechar";
    c.onclick = closeOverlay;

    const inner = create('div');
    inner.className = "player-inner";

    const h = create('h2');
    h.textContent = mod.titulo || "Conte√∫do do Combo";
    inner.appendChild(h);

    itens.forEach(item => {
      const box = create('div');
      box.style.marginBottom = "22px";

      const h3 = create('h3');
      h3.textContent = item.nome;
      box.appendChild(h3);

      const desc = create('p');
      desc.textContent = item.descricao || "";
      box.appendChild(desc);

      const b = create('button');
      b.className = "btn";
      b.textContent = "Abrir";
      b.onclick = () => openDriveModal(item.link, item.nome);
      box.appendChild(b);

      inner.appendChild(box);
    });

    p.appendChild(c);
    p.appendChild(inner);
    o.appendChild(p);
    document.body.appendChild(o);

  }catch(e){
    alert("Erro ao carregar m√≥dulo: " + key);
    console.error(e);
  }
}

/* ===============================
   CARDS
================================*/
function createCard(item, actionText, actionFn){
  const card = create('div');
  card.className = "card";

  const img = create('img');
  img.className = "thumb";
  img.src = item.thumbnail || item.imagem || item.capa || item.cover_image_url || "";
  card.appendChild(img);

  const body = create('div');
  body.className = "card-body";

  const h = create('h3');
  h.textContent = item.name || item.nome || "Produto";
  body.appendChild(h);

  const p = create('p');
  p.textContent = item.descricao || item.description || "";
  body.appendChild(p);

  const row = create('div');
  row.className = "row-btns";

  const btn = create('button');
  btn.className = "btn buy";
  btn.textContent = actionText;
  btn.onclick = actionFn;

  row.appendChild(btn);
  body.appendChild(row);
  card.appendChild(body);

  return card;
}

function createModuleCard(item, text){
  return createCard(item, text, () => {
  if (classificar(item) !== "combo") {
    alert("Este produto n√£o √© um combo.");
    return;
  }
  openModule(item.deliverable_key);
});


/* ===============================
   NAVEGA√á√ÉO
================================*/
function showSection(id){
  const ids = ['videos','ebooks','recs'];
  ids.forEach(sec => {
    const node = el('#' + sec);
    if (!node) return;
    if (id === 'all' || sec === id){
      node.style.display = "block";
      node.style.opacity = 1;
    } else {
      node.style.display = "none";
      node.style.opacity = 0;
    }
  });
}

/* menu mobile */
el('#menuToggle').onclick = () => {
  el('#menuNav').classList.toggle('open');
};

/* cliques de navega√ß√£o */
el('#menuInicio').onclick = (ev) => {
  ev.preventDefault();
  showSection('all');
};

el('#menuVideos').onclick = (ev) => {
  ev.preventDefault();
  showSection('videos');
};

el('#menuEbooks').onclick = (ev) => {
  ev.preventDefault();
  showSection('ebooks');
};

el('#menuRecs').onclick = (ev) => {
  ev.preventDefault();
  showSection('recs');
};

el('#goHome').onclick = () => showSection('all');

/* ===============================
   CLASSIFICA√á√ÉO
================================*/
function classificar(item){
  if (item.video) return "video";
  const tipo = (item.type || item.tipo || "").toLowerCase();
  if (tipo.includes("video")) return "video";
  return "ebook";
}

/* ===============================
   /API/MY-PRODUCTS + RENDER
================================*/
async function carregarMeusProdutos(){
  try {
    const email = localStorage.getItem("chef_user_email");
    if (!email){
      alert("Fa√ßa login para acessar seus produtos.");
      return;
    }

    const r = await fetch("/api/my-products", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });

    const data = await r.json();
    if (!data.success){
      throw new Error(data.message || "Falha ao carregar produtos");
    }

    const produtos = data.products || [];
    window.userEmail = email;
    window.userProducts = produtos;

    const listaVideos = [];
    const listaEbooks = [];
    const listaModulos = [];

    produtos.forEach(p => {
  const tipo = classificar(p);

  if (tipo === "combo") {
    listaModulos.push(p);
    return;
  }

  if (tipo === "video") {
    listaVideos.push(p);
    return;
  }

  // tudo que sobrar √© ebook
  listaEbooks.push(p);
});

    /* v√≠deos */
    const gridV = el("#gridVideos");
    gridV.innerHTML = "";

    listaVideos.forEach(p => {
      const link = p.drive_link || p.video;
      const card = createCard(
        p,
        "Assistir",
        () => openDriveModal(link, p.name || p.nome)
      );
      gridV.appendChild(card);
    });

    // m√≥dulos tamb√©m aparecem em v√≠deos
    listaModulos.forEach(p => {
      const card = createModuleCard(p, "Acessar Conte√∫do");
      gridV.appendChild(card);
    });

    el("#msgVideos").style.display = gridV.children.length ? "none" : "block";

    /* e-books */
    const gridE = el("#gridEbooks");
    gridE.innerHTML = "";

    listaEbooks.forEach(p => {
      const link = p.drive_link || p.ebook || p.link;
      const card = createCard(
        p,
        "Abrir E-book",
        () => openDriveModal(link, p.name || p.nome)
      );
      gridE.appendChild(card);
    });

    // m√≥dulos tamb√©m aparecem em e-books
    listaModulos.forEach(p => {
      const card = createModuleCard(p, "Acessar Conte√∫do");
      gridE.appendChild(card);
    });

    el("#msgEbooks").style.display = gridE.children.length ? "none" : "block";

  } catch (err){
    console.error("Erro em carregarMeusProdutos:", err);
    alert("Erro ao carregar seus produtos.");
  }
}

/* ===============================
   RECOMENDA√á√ïES
================================*/
async function loadRecs(){
  try {
    const email = localStorage.getItem("chef_user_email");
    if (!email) return;

    const r = await fetch("/api/recommendations?email=" + encodeURIComponent(email));
    const data = await r.json();

    const lista = data.items || data.products || [];
    const grid = el("#gridRecs");
    grid.innerHTML = "";

    lista.forEach(p => {
      const card = createCard(
        p,
        "Comprar",
        () => window.open(p.checkout_link, "_blank")
      );
      grid.appendChild(card);
    });

    el("#msgRecs").style.display = grid.children.length ? "none" : "block";

  } catch(e){
    console.error("Erro em loadRecs:", e);
  }
}

/* ===============================
   ABRIR √ÅREA DE MEMBROS
================================*/
async function abrirAreaDeMembros(){
  el("#landing").style.display = "none";
  el("#appHeader").style.display = "block";
  el("#searchBar").style.display = "block";
  el("#appMain").style.display = "block";

  showSection("videos");
  await carregarMeusProdutos();
  await loadRecs();
}

/* ===============================
   BOT√ÉO ACESSAR (OP√á√ÉO B)
================================*/
el("#enterBtn").onclick = () => {
  const email = localStorage.getItem("chef_user_email");
  if (!email){
    // ainda n√£o logou ‚Üí vai para login
    location.href = "login.html";
  } else {
    // j√° logado ‚Üí entra direto na √°rea
    abrirAreaDeMembros();
  }
};

/* ===============================
   LOGOUT
================================*/
el("#logoutBtn").onclick = () => {
  localStorage.removeItem("chef_user_email");
  window.location.href = "login.html";
};
</script>
</body>
</html>



