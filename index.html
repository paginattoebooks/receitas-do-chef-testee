<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Paginatto ‚Äì √Årea de Membros</title>

<style>
  /* =============== BRAND / MOBILE FIRST =============== */
  :root{
    /* cores inspiradas na imagem "tom da p√°gina" (turquesa) */
    --brand-900:#062b34;   /* bem escuro */
    --brand-800:#0a3a46;
    --brand-700:#0f4b59;
    --brand-600:#135d6e;
    --brand-500:#167485;   /* cor principal */
    --brand-400:#1b8ea2;
    --brand-300:#45aebf;
    --brand-200:#7bc8d6;
    --brand-100:#b6e5ec;

    --bg: linear-gradient(135deg, var(--brand-900) 0%, var(--brand-600) 60%, var(--brand-500) 100%);
    --text:#101417;
    --muted:#6a7b82;
    --card:#ffffff;
    --soft:#f6f9fa;

    --radius:16px;
    --shadow:0 8px 20px rgba(0,0,0,.15);
  }

  *{box-sizing:border-box}
  html,body{margin:0}
  body{
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Inter, Arial, sans-serif;
    color:var(--text);
    background:var(--bg) fixed;
    min-height:100vh;
  }

  /* =============== HEADER =============== */
  header{
    position:sticky; top:0; z-index:50;
    background: rgba(6, 43, 52, .75);
    backdrop-filter: blur(10px);
    padding: 10px 14px;
    display:flex; align-items:center; justify-content:space-between;
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .brand{
    display:flex; gap:10px; align-items:center;
  }
  .brand img{
    width:34px; height:34px; object-fit:contain;
    /* deixa a logo azul totalmente branca (texto branco) */
    filter: brightness(0) saturate(0) invert(1);
  }
  .brand span{
    color:#fff; font-weight:700; letter-spacing:.3px; font-size:18px;
  }

  .menu{
    display:flex; gap:14px; align-items:center;
  }
  .menu a, .menu button{
    appearance:none; border:0; background:transparent; color:#e9f7fb;
    font-size:14px; padding:6px 8px; border-radius:10px; cursor:pointer;
  }
  .menu a:hover, .menu button:hover{
    background:rgba(255,255,255,.08);
  }

  /* =============== SEARCH =============== */
  .search-wrap{
    padding:14px 12px 0;
  }
  .search{
    display:grid; grid-template-columns: 1fr auto; gap:8px;
    background:rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.18);
    border-radius:999px; padding:10px 12px;
  }
  .search input{
    background:transparent; border:0; outline:0; color:#e8fbff; font-size:14px;
  }
  .search input::placeholder{color:#c9e7ed}
  .search button{
    background:var(--brand-300); border:0; color:#08333e;
    font-weight:700; padding:10px 14px; border-radius:999px; cursor:pointer;
  }

  /* =============== CONTAINERS =============== */
  .section{
    background:var(--soft);
    margin:12px 0 24px; border-top-left-radius:24px; border-top-right-radius:24px;
    padding:20px 14px 30px;
  }
  .container{max-width:1040px; margin:0 auto}

  .title{
    font-size:26px; line-height:1.25; margin:6px 4px 4px;
    color: var(--brand-700);
    font-weight:800;
  }
  .subtitle{
    margin:0 4px 14px; color:var(--muted); font-size:14px;
  }

  /* =============== GRIDS / CARDS =============== */
  .grid{
    display:grid; gap:12px;
    grid-template-columns: 1fr;
  }
  @media(min-width:640px){ .grid{grid-template-columns: repeat(2,1fr);} }
  @media(min-width:960px){ .grid{grid-template-columns: repeat(3,1fr);} }

  .card{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
    overflow:hidden; display:flex; flex-direction:column; min-height:180px;
  }
  .thumb{
    width:100%; aspect-ratio:16/9; object-fit:cover; display:block;
    background:#eaf2f4;
  }
  .content{ padding:12px 14px 14px }
  .card h4{ margin:0 0 6px; font-size:16px }
  .meta{ color:var(--muted); font-size:13px; margin-bottom:10px }
  .btns{ display:flex; gap:8px; margin-top:auto; }
  .btn{
    flex:1; text-align:center;
    background:var(--brand-500); color:#fff; border:0; padding:10px 0;
    border-radius:12px; font-weight:700; cursor:pointer;
  }
  .btn.alt{ background:var(--brand-300); color:#08333e; font-weight:800 }
  .btn.secondary{ background:#eef5f6; color:var(--brand-700); font-weight:800 }

  .empty, .error{
    padding:14px; border-radius:12px; background:#fff1f1; color:#b03939; font-size:14px;
    margin:8px 0;
  }
  .empty{ background:#f0fbff; color:#0b5161 }

  /* =============== MODALS (v√≠deo / ebook / drive) =============== */
  .modal{
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,.85); z-index:1000; padding:16px;
  }
  .modal-inner{ width:100%; max-width:900px; background:#000; border-radius:16px; overflow:hidden; position:relative }
  .modal-header{
    position:absolute; top:8px; left:8px; z-index:2;
    display:flex; gap:8px;
  }
  .modal-header button{
    background:rgba(0,0,0,.6); color:#fff; border:0; padding:6px 10px; border-radius:999px; cursor:pointer;
  }
  .modal iframe, .modal video, .modal img{
    width:100%; height:min(78vh,640px); display:block; border:0; object-fit:contain; background:#000;
  }

  /* =============== FOOTER =============== */
  footer{
    color:#d9f6fb; text-align:center; padding:24px 12px 36px; font-size:12px;
  }
</style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="brand">
      <!-- Use o arquivo: logo azul sem sombra.png (ser√° mostrado branco pelo filter) -->
      <img src="logo azul sem sombra.png" alt="Paginatto">
      <span>Paginatto</span>
    </div>
    <nav class="menu">
      <a href="#" id="goHome">In√≠cio</a>
      <a href="#videos">Meus V√≠deos</a>
      <a href="#ebooks">Meus E-books</a>
      <a href="#recs">Recomenda√ß√µes</a>
      <button id="logoutBtn">Sair</button>
    </nav>
  </header>

  <!-- SEARCH -->
  <div class="search-wrap container">
    <div class="search">
      <input id="q" type="search" placeholder="Buscar receitas, e-books, v√≠deos‚Ä¶ (ex.: dor, bolo, airfryer)" />
      <button id="btnSearch">üîé</button>
    </div>
  </div>

  <!-- V√çDEOS -->
  <section class="section" id="videos">
    <div class="container">
      <h2 class="title">Suas V√≠deo Aulas</h2>
      <p class="subtitle">Cursos em v√≠deo liberados para o seu e-mail.</p>
      <div id="videosList" class="grid"></div>
      <div id="videosMsg"></div>
    </div>
  </section>

  <!-- EBOOKS -->
  <section class="section" id="ebooks">
    <div class="container">
      <h2 class="title">Seus E-books</h2>
      <p class="subtitle">Materiais digitais liberados para o seu e-mail.</p>
      <div id="ebooksList" class="grid"></div>
      <div id="ebooksMsg"></div>
    </div>
  </section>

  <!-- RECOMENDA√á√ïES -->
  <section class="section" id="recs">
    <div class="container">
      <h2 class="title">Outros produtos pra voc√™</h2>
      <p class="subtitle">Sugest√µes do nosso cat√°logo que ainda n√£o est√£o liberadas pra voc√™.</p>
      <div id="recsList" class="grid"></div>
      <div id="recsMsg"></div>
    </div>
  </section>

  <footer>
    ¬© 2025 PAGINATTO ‚Äî O MUNDO DOS EBOOKS
  </footer>

<script>
  /* ========= helpers ========= */
  const email = (localStorage.getItem('chef_user_email') || '').trim().toLowerCase();
  const el = (id)=>document.getElementById(id);

  function guard(){
    if(!email){
      alert('Fa√ßa login para acessar sua √°rea de membros.');
      location.href = '/login.html';
      return false;
    }
    return true;
  }

  function msg(target, text, type='error'){
    const box = el(target);
    if(!box) return;
    box.innerHTML = `<div class="${type}">${text}</div>`;
  }

  function cardHTML(p, type){
    // type: 'video' ou 'ebook' (apenas usado no r√≥tulo/CTA)
    const cover = p.cover_image_url || p.cover_image || p.image || '';
    const label = type === 'video' ? 'Assistir' : 'Abrir';
    return `
      <article class="card">
        <img class="thumb" src="${cover}" alt="">
        <div class="content">
          <h4>${p.name || p.title}</h4>
          <div class="meta">${p.description ? (p.description).slice(0,90) : ''}</div>
          <div class="btns">
            <button class="btn" onclick='openDeliverable(${JSON.stringify(p)})'>${label}</button>
            ${p.checkout_link ? `<a class="btn secondary" href="${p.checkout_link}" target="_blank" rel="noopener">Comprar</a>` : ''}
          </div>
        </div>
      </article>
    `;
  }

  /* ========= open deliverable inside the site ========= */
  function openDeliverable(p){
    const url = (p.drive_link || p.drive_url || p.file_url || p.video_url || '').trim();
    const isDriveFile = /https?:\/\/drive\.google\.com\/file\/d\//.test(url);
    const isDriveFolder = /https?:\/\/drive\.google\.com\/drive\/folders\//.test(url);
    const isVideo = /\.(mp4|webm|ogg)$/i.test(url);
    const isImage = /\.(png|jpg|jpeg|webp|gif)$/i.test(url);
    const isPdf = /\.pdf$/i.test(url);

    const m = document.createElement('div');
    m.className = 'modal';
    m.innerHTML = `
      <div class="modal-inner">
        <div class="modal-header">
          <button onclick="this.closest('.modal').remove()">‚Üê Voltar</button>
          ${p.name ? `<button disabled style="opacity:.8">${p.name}</button>`:''}
        </div>
        <div id="modalBody"></div>
      </div>`;
    document.body.appendChild(m);

    const body = m.querySelector('#modalBody');

    if(isDriveFile){
      const id = url.match(/\/file\/d\/([^/]+)/)[1];
      body.innerHTML = `<iframe src="https://drive.google.com/file/d/${id}/preview" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    } else if(isDriveFolder){
      body.innerHTML = `<iframe src="${url}" allowfullscreen></iframe>`;
    } else if(isVideo){
      body.innerHTML = `<video src="${url}" controls autoplay playsinline></video>`;
    } else if(isImage){
      body.innerHTML = `<img src="${url}" alt="">`;
    } else if(isPdf){
      body.innerHTML = `<iframe src="${url}" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    } else if(url){
      // fallback
      body.innerHTML = `<iframe src="${url}" allowfullscreen></iframe>`;
    } else {
      body.innerHTML = `<div style="color:#fff; padding:18px">N√£o encontrei um link de entrega para este item.</div>`;
    }
  }

  /* ========= load: my products (videos + ebooks) ========= */
  async function loadMyProducts(){
    if(!guard()) return;
    try{
      const r = await fetch('/api/my-products', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email }) });
      const data = await r.json();

      const all = Array.isArray(data) ? data : (data.items || []);
      const videos = all.filter(x => (x.type || '').toLowerCase().includes('video'));
      const ebooks = all.filter(x => (x.type || '').toLowerCase().includes('ebook'));

      // v√≠deos
      const vList = el('videosList');
      if(videos.length){
        vList.innerHTML = videos.map(p => cardHTML(p,'video')).join('');
      }else{
        vList.innerHTML = '';
        msg('videosMsg','Voc√™ ainda n√£o tem v√≠deo aulas liberadas. Veja nossas op√ß√µes abaixo üëá','empty');
      }

      // ebooks
      const eList = el('ebooksList');
      if(ebooks.length){
        eList.innerHTML = ebooks.map(p => cardHTML(p,'ebook')).join('');
      }else{
        eList.innerHTML = '';
        msg('ebooksMsg','Voc√™ ainda n√£o tem e-books liberados. Veja recomenda√ß√µes abaixo üëá','empty');
      }
    }catch(err){
      console.error(err);
      msg('videosMsg','Erro ao carregar seus v√≠deos.'); 
      msg('ebooksMsg','Erro ao carregar seus e-books.');
    }
  }

  /* ========= load: recommendations ========= */
  async function loadRecs(){
    if(!guard()) return;
    try{
      const r = await fetch(`/api/recommendations?email=${encodeURIComponent(email)}`);
      const data = await r.json();
      const list = Array.isArray(data) ? data : (data.items || []);
      const recs = el('recsList');
      if(list.length){
        recs.innerHTML = list.map(p => cardHTML(p,'ebook')).join('');
      }else{
        recs.innerHTML = '';
        msg('recsMsg','Sem recomenda√ß√µes no momento.','empty');
      }
    }catch(err){
      console.error(err);
      msg('recsMsg','Falha ao carregar recomenda√ß√µes.');
    }
  }

  /* ========= search ========= */
  async function doSearch(){
    const q = el('q').value.trim();
    if(!q) return;
    try{
      const r = await fetch('/api/search', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ q, email })
      });
      const data = await r.json();
      const list = Array.isArray(data) ? data : (data.items || []);
      if(!list.length){ alert('Nada encontrado para: ' + q); return; }

      // mostro os resultados substituindo temporariamente a se√ß√£o de recomenda√ß√µes
      const recs = el('recsList');
      el('recsMsg').innerHTML = '';
      recs.innerHTML = list.map(p => cardHTML(p, (p.type||'').toLowerCase().includes('video')?'video':'ebook')).join('');
      location.hash = '#recs';
    }catch(err){
      console.error(err);
      alert('Erro na busca.');
    }
  }

  /* ========= nav / events ========= */
  document.addEventListener('DOMContentLoaded', () => {
    if(!guard()) return;
    loadMyProducts();
    loadRecs();

    el('btnSearch').addEventListener('click', doSearch);
    el('q').addEventListener('keydown', (e)=>{ if(e.key==='Enter') doSearch(); });

    el('logoutBtn').addEventListener('click', ()=>{
      localStorage.removeItem('chef_user_email');
      location.href = '/login.html';
    });
    el('goHome').addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top:0,behavior:'smooth'}); });
  });
</script>
</body>
</html>
